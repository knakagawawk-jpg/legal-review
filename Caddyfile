# ローカル開発用（ドメインなし、HTTPのみ）
# docker-compose.ymlで profiles: local を使用する場合
:80 {
    # Next.js（新UI）にリバースプロキシ（開発用サービス）
    reverse_proxy web-dev:3000 {
        transport http {
            dial_timeout 10s
            response_header_timeout 30s  # ヘルスチェック用に少し長めに設定
            read_timeout 30s
            write_timeout 10s
        }
    }
}

# 本番環境用の設定例（Caddyfile.production を参照）
# 環境変数 CADDY_DOMAIN が設定されている場合、Caddyfile.production を使用することを推奨
# 使用方法: docker-compose.ymlのproxyサービスで volumes を以下のように変更:
#   - ./Caddyfile.production:/etc/caddy/Caddyfile:ro

# Basic認証を有効化する場合:
# 1. Caddyfile.production の basicauth セクションのコメントを解除
# 2. パスワードハッシュを生成: caddy hash-password --plaintext your-password
# 3. 環境変数 BASIC_AUTH_USER と BASIC_AUTH_PASS_HASH を設定

# HTTPSはCaddyが自動で証明書を取得・更新します
# Let's Encryptを使用し、初回アクセス時に自動で証明書が発行されます
# 証明書は caddy_data ボリュームに永続化されます
