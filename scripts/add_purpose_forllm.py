# -*- coding: utf-8 -*-
"""R1の出題趣旨にpurpose_forllm（案A・セグメント配列）を追加する"""
import json
import os

R1_DIR = r"c:\Users\tvxqt\.shihou-zyuken2601\law-review\data\json\preliminary_exam\R1"

# 一般教養・実務基礎は除外
EXCLUDE = ["一般教養", "実務基礎"]

# 各ファイルの purpose_forllm segments 定義
SEGMENTS = {
    "R1_予備_憲法.json": [
        {"type": "common", "text": "本問では，主として①信教の自由に基づく一般的な義務の免除の可否，②代替措置を講じることの政教分離原則との関係など具体的な検討が問題となるほか,③教育を受ける権利，④外国人の人権享有主体性や未成年者の人権等の論点が含まれる。\n判例としては，剣道受講拒否事件（最高裁判所第二小法廷平成８年３月８日判決，民集５０巻３号４６９頁）を意識することが求められる。もっとも，事案には異なるところが少なくないので，直接参考になるとは限らず，同事件との異同を意識しつつ，事案に即した検討が必要である。\n①については，水泳実技への参加とＢ教の教義との関係，代替措置が認められないことによる結果の重大性などを事案に即して把握し，信教の自由への影響の大きさを的確に把握して，判断枠組みを設定することが求められる。\n②は，①で設定した判断枠組みに基づく具体的検討に当たるものである。政教分離原則との関係の点も含め，代替措置をとらないことについて校長が示した理由が詳しく述べられているので，それに即して分析を進めることが必要である。\n以上が必ず論じてもらいたい内容であり，③④はそれに比較すると優先度は落ちるが，詳しく検討するためには必要な点である。特に，本件は，正面からその侵害を問題とするかどうかはともかく，社会権である教育を受ける権利が関わってくる事案である。社会権は外国人には保障されないという一般論が，学習権を背景とする教育を受ける権利との関係でも妥当するかという問題意識を感じてもらいたいところである。"}
    ],
    "R1_予備_民法.json": [
        {"type": "q1", "text": "設問１は，同一不動産をめぐって多重の取引がされた事案を題材として，不動産物権変動の優劣に関する基本的な知識・理解を問うとともに，事案に即した分析能力や法的思考力を試すものである。\n解答に当たっては，所有権に基づく物権的返還請求権の各要件を検討する必要があり，特に，抵当権設定と贈与による所有権移転との対抗関係を丁寧に説明することが求められる。また，Ｃの占有権原の有無については，法定地上権の成否が特に問われるが，その制度趣旨や事案に現れている諸事情を踏まえて検討することが求められる。"},
        {"type": "q2", "text": "設問２は，不動産が１０年間以上占有された事案を題材として，取得時効の要件に関する基本的な知識・理解を問うとともに，取得時効の効果等について，事案に即した分析能力を試すものである。\n解答に当たっては，所有権に基づく妨害排除請求権の各要件を検討する必要があるが，短期取得時効の各要件について当てはめを行った上で，取得時効の効果は抵当権の消滅を伴うものであるのか，仮に消滅を伴う場合にはこれを主張するために登記が必要となるのかなどについて論じることが求められる。"}
    ],
    "R1_予備_民事訴訟法.json": [
        {"type": "common", "text": "本問は，当事者に生じた事情変更に関する諸問題についての理解を問うものである。そして，具体的な事実関係を的確に読み込み，一方当事者側(本問では原告側)から問題を処理し得る理論構成ができるかを評価するものである。"},
        {"type": "q1", "text": "設問１では，訴え提起後訴訟係属前に共同原告の一人が死亡してしまった場合に，残った原告側の対応が問題となっている。具体的には，判例の立場では固有必要的共同訴訟とされる本件共同訴訟の性質を踏まえつつ，原告側での死者名義訴訟の処理について検討することが求められている。"},
        {"type": "q2", "text": "設問２は，前訴判決の既判力を第三者に拡張できるかを問うものである。問題文では，原告らが売買を理由とする土地の移転登記手続を求めていた前訴の口頭弁論終結前に登記が被告から第三者に移転しており，その移転を原告らが知り得ないまま，原告ら勝訴判決を得て，それが確定した。その後，原告らが当該第三者への登記移転の事実を知り，当該第三者に対して所有権移転登記請求訴訟を提起した場合に，前訴判決の既判力が当該第三者に及ぶとする（原告ら側からの）理論構成を問うものである。主に，民事訴訟法第１１５条第１項第４号（目的物の所持者）の類推適用可能性が問われている。"}
    ],
    "R1_予備_刑法.json": [
        {"type": "common", "text": "本問は，甲が，(1)Ｖから本件土地に対する抵当権設定の代理権しか付与されていなかったのに，Ａに本件土地を売る旨の売買契約書２部に「Ｖ代理人甲」と署名した上，その内容をＡに確認させるなどしたこと，(2)Ｖに無断で本件土地の売買契約をＡと締結したこと，(3)(2)に関して，逮捕を免れるなどのために，Ｖを殺害してその死体を海中に捨てることを計画し，実際にＶの首を絞めたが，それにより失神したＶが死亡したものと軽信し，その状態のＶを海に落とし溺死させたことを内容とする事例について，甲の罪責に関する論述を求めるものである。\n(1)については，本件土地の売買契約書の作成権限が与えられていなかった甲による同契約書の作成が代理権限の逸脱に当たることを前提に，有印私文書偽造罪・同行使罪の成否について，文書の名義人に関する擬律判断を含め，その構成要件該当性を検討する必要がある。\nまた，(2)については，主に論ずべき点として，横領罪と背任罪の関係を踏まえて，本件土地に関する（横領罪における）占有が甲に認められるか，それが認められるとした場合に甲の行為が「横領」と評価できるか（既遂時期），仮に横領罪の成立が否定された場合に背任罪の成否を検討すべきかについて，本事例における事実関係を基に検討する必要がある。\n(3)については，行為者が第１行為（Ｖの首を絞める行為）により死亡結果が発生すると予見していたのに，実際は結果が発生せず，第２行為（失神したＶを海に落とした行為）により死亡結果が発生した場合（いわゆる遅すぎた構成要件の実現）の殺人既遂罪の成否に関し，第１行為と死亡結果との因果関係の有無及び因果関係の錯誤の処理，並びに，第２行為の擬律（抽象的事実の錯誤，過失致死罪の成否）について，また，第１行為と第２行為を１個の行為（一連の実行行為）と捉えた場合は，１個の行為と評価する根拠について，それぞれ検討する必要がある。\nいずれについても，各構成要件等の正確な知識，基本的理解や，本事例にある事実を丁寧に拾って的確に分析した上，当てはめを行う能力が求められる。"}
    ],
    "R1_予備_行政法.json": [
        {"type": "q1", "text": "設問１においては，Ａ県屋外広告物条例（以下「条例」という。）に基づく広告物設置等の許可処分（以下「本件許可処分」という。）について，それにより景観や生活・健康が害されることを主張する隣地居住者の原告適格を，当該原告の立場から検討することが求められる。\nまず，行政事件訴訟法第９条第１項所定の「法律上の利益を有する者」に関する最高裁判例で示されてきた判断基準について，第三者の原告適格の判断に即して，正しく説明されなければならない。\nその上で，原告が主張する景観と生活・健康（安眠）に関する利益について，それぞれ，本件許可処分の根拠法規である条例やＡ県屋外広告物条例施行規則（以下「規則」という。）によって保護されているものであることが，許可の要件や目的などに即して，具体的に説明されなければならない。\nさらに，これらの利益について，それらが一般的な公益に解消しきれない個別的利益といえることが，その利益の内容や範囲等の具体的な検討を通じて，説明されなければならない。"},
        {"type": "q2", "text": "設問２においては，許可地域等において広告物等と鉄道等との距離を要件とする規則所定の許可基準について，条例がこれを委任した趣旨に適合し委任の範囲内にあるかを，その無効を主張する原告の立場から検討することが求められる。\nまず，この規則が定める許可基準が条例の委任に基づいて定められた委任命令であり，条例の委任の趣旨に反すれば無効となることが明確にされなければならない。\nつぎに，条例の委任の趣旨，言い換えれば条例が許可制度を設けた趣旨について，目的規定，許可地域等の定め方など，条例の規定に照らして，具体的に検討されなければならない。\n最後に，こうした目的に照らして，鉄道から広告物等が見通せるか否かを問題にすることなく，それとの距離を要件とする許可基準の定め方につき，これが条例の委任の趣旨と矛盾することから，これを定める規則が無効であるとの結論が導かれるべきこととなる。"}
    ],
    "R1_予備_刑事訴訟法.json": [
        {"type": "common", "text": "本問は，民家で発生した窃盗事件について，翌日の未明に，警察官ＰとＱが，路上で，人相及び着衣が犯人と酷似する甲を認め，職務質問を開始したところ，甲のズボンのポケットからＶ名義のクレジットカードが路上に落ちたことから，抵抗する甲をパトカーに押し込んでＨ警察署に連れて行き，その後，甲を通常逮捕して，勾留したとの事例において，甲の勾留の適法性の検討を通じ，刑事訴訟法の基本的な学識の有無及び具体的事案における応用力を試すものである。\n刑事訴訟法上，逮捕と勾留は別個の処分であるが，先行する逮捕手続（さらに，同行の過程）に違法がある場合，引き続く勾留の適法性に影響を及ぼすことがあるとの理解が一般的であり，甲の勾留の適法性を検討するに当たっては，先行手続の違法が問題となる。もっとも，この点については，勾留の理由や必要（刑事訴訟法第２０７条第１項，第６０条第１項，第８７条）と異なり，明文で要件とされているわけではなく，逮捕手続の違法についても，逮捕後の時間的制限の不遵守がある場合に勾留請求を却下すべきとする（刑事訴訟法第２０６条第２項，第２０７条第５項）にとどまるため，なぜ先行手続の違法が勾留の適法性に影響を及ぼすのかについて，具体的根拠を示して論ずることが求められる。他方，先行手続の違法が軽微であっても直ちに勾留が違法となるとすれば，被疑者の逃亡や罪証隠滅を防いだ状態で捜査を続行することが困難となるのであって，先行手続の違法が勾留の適法性に影響を及ぼすと考えるとしても，いかなる場合に勾留が違法となるか，その判断基準を明らかにすることも必要である。\n本問では，先行手続として，警察官が甲をパトカーに押し込んでＨ警察署に連れて行った行為について，実質的な逮捕であり違法ではないかが問題となる。ここでは，任意同行と実質的な逮捕とを区別する基準を示した上で，警察官の行為が実質的逮捕であるか否かを判断することが求められる。そして，警察官の上記行為が実質的な逮捕であり違法と評価される場合，その違法が勾留の適法性に影響するのか，影響するのであれば，勾留が違法となる場合に当たるかについて，判断基準を示して検討することが求められる。また，この点について，先行手続の違法の程度（重大か否か）に着目するのであれば，【事例】において侵害された法益の質・程度や本来可能であった適法行為からの逸脱の程度（例えば，実質的な逮捕がなされた時点において緊急逮捕の要件を実質的に満たしていたか，満たしていたとして，その時点から起算して被疑者が検察官に送致され，また勾留を請求するまでの時間的制限を超過していないか，また，実質的な逮捕から約５時間後，甲の取調べ等を挟んで通常逮捕の手続が取られていることをどう評価するか）などに関わる具体的事情を考慮した上で，先行手続の違法の程度を吟味し，勾留が違法と評価されるか否かについて論述することが求められる。"}
    ],
    "R1_予備_商法.json": [
        {"type": "common", "text": "本問は，取締役の解任を目的とする株主総会の招集を決定する取締役会決議の効力（〔設問１〕）及び取締役を解任する株主総会決議の効力（〔設問２〕）を，それぞれその効力を否定する立場からの主張とその当否という形で問うものである。"},
        {"type": "q1", "text": "設問１では，Ｄは，まず，本件取締役会決議が予定されていなかった事項に関する決議であった点が違法であると主張することが考えられるが，会社業務に関し臨機応変に対応すべき取締役会では，決議事項として予定されていなかった事項であっても必要に応じ決議することができると解される。次に，Ｄは，Ｄを特別利害関係人（会社法第３６９条第２項）に当たるとして議決に参加させなかった点が違法であると主張することが考えられる。代表取締役を解職する取締役会決議については，当該決議の対象となる代表取締役は特別利害関係人に当たるとする判例（最判昭和４４年３月２８日民集２３巻３号６４５頁）があり，これとの距離感を踏まえて検討することが求められる。そして，Ｄが特別利害関係人に当たるとする場合には，本件取締役会決議が成立要件（同条第１項）を満たしているか，当たらないとする場合には，瑕疵のある取締役会決議の効力が問題となる。"},
        {"type": "q2", "text": "設問２では，Ｄは，株主総会決議の取消しの訴え（会社法第８３１条第１項）を提起するため，取消事由として，まず，Ａが保有していた甲社株式１００株を定足数要件の分母に算入すれば定足数（同法第３４１条）を満たさないため，決議の方法の法令違反に当たる（同法第８３１条第１項第１号）と主張することが考えられる。当該１００株については，遺産分割未了のまま相続人Ｂ，Ｃ，Ｄ及びＥの共有状態にあり，権利行使者の指定・通知がないので，甲社の同意がない限り議決権を行使することができない（同法第１０６条）ため，「議決権を行使することができる株主の議決権」（定足数要件の分母。同法第３４１条）には含まれないと文言上は考えられるが，他方，共有株式は権利行使者の指定・通知があるまで暫定的に議決権を行使できないだけで，定足数要件の分母には含まれるという解釈があり，このような解釈も踏まえつつ検討することが求められる。次に，Ｄは，取消事由として，本件会社分割による譲渡制限株式の承継は譲渡承認を要しない「一般承継」（同法第１３４条第４号）に該当するから，株主名簿の名義書換の不当拒絶があり，丙社は名義書換がなくとも自己が株主であることを甲社に対抗できるため，丙社に招集通知を発しなかった点は招集の手続の法令違反に，丙社の議決権を認めなかった点は決議の方法の法令違反に，それぞれ当たる（同法第８３１条第１項第１号）と主張することが考えられる。会社分割は，合併と同じく組織再編の一形態とされているが，他方，合併と異なり分割会社は依然として存続し，承継される権利義務の範囲は当事会社の裁量に委ねられており，このような異同も踏まえつつ検討することが求められる。"}
    ],
}

def main():
    for filename, segments in SEGMENTS.items():
        filepath = os.path.join(R1_DIR, filename)
        if not os.path.exists(filepath):
            print(f"Skip (not found): {filename}")
            continue
        with open(filepath, "r", encoding="utf-8") as f:
            data = json.load(f)
        if "purpose" not in data:
            print(f"Skip (no purpose): {filename}")
            continue
        data["purpose_forllm"] = {"segments": segments}
        with open(filepath, "w", encoding="utf-8") as f:
            json.dump(data, f, ensure_ascii=False, indent=None)
        print(f"Updated: {filename}")

if __name__ == "__main__":
    main()
