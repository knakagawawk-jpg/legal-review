# 実装計画：ユーザーデータ管理の改善

## 📋 提案の整理

### 1. ダッシュボード情報

**提案:**
- 一時的にlocalStorageに保存
- 毎朝4時にDBにInsert（日次履歴として保存）
- ユーザーによる編集も可能

**実装方針:**
- `UserDashboard`: 現在のダッシュボード情報（リアルタイム編集用）
- `UserDashboardHistory`: 日次履歴テーブル（毎朝4時に自動保存）
- フロントエンド: localStorageに一時保存 + 定期的にDBに同期

### 2. フリーチャット

**提案:**
- 新規作成時にThreadをDBにInsert ✅（既に実装済み）
- チャットが出るごとにMessageをInsert ✅（既に実装済み）
- ユーザーはThreadテーブルをキーにDBからクエリ ✅（既に実装済み）

**現状:** 既に提案通り実装済み

### 3. 講評

**提案:**
- 作成時にReviewをInsert
- ユーザーの講評使用履歴を別テーブルで管理（全体の講評DBのidを外部キーに）
- 同テーブルを使ってクエリ

**実装方針:**
- `Review`: 共有講評テーブル（user_idを削除、共有可能な講評）
- `UserReviewHistory`: ユーザーの講評使用履歴（review_idを外部キーに）

**注意:** 現在のReviewテーブルはuser_idで直接管理されているため、大きな変更が必要

### 4. ユーザー設定

**提案:**
- ユーザーごとに設定テーブルを作成 ✅（既にUserPreferenceテーブルあり）

**現状:** 既に実装済み

## 🎯 実装優先順位

1. **ダッシュボード日次履歴テーブルの追加**
2. **講評テーブルの再設計**（共有講評 + ユーザー履歴）
3. **API実装**（ダッシュボード、講評）
4. **フロントエンド統合**
